<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Times Calculator - Accurate Sunrise & Sunset Times for Any Location</title>
    <meta name="description" content="Calculate precise sunrise and sunset times for any location worldwide. Get golden hour times, twilight information, and day length data. Free online sun calculator.">
    <meta name="keywords" content="sunrise calculator, sunset times, sun calculator, golden hour, twilight times, day length">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZB05P3YGD8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZB05P3YGD8');
    </script>
    
    <style>
        :root {
            --primary: #FF6B35;
            --primary-light: #FF8A65;
            --secondary: #2E86AB;
            --text: #2D3748;
            --text-light: #718096;
            --bg: #FFFFFF;
            --bg-light: #F7FAFC;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border: #E2E8F0;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
        }
        
        .hero-section {
            background: var(--bg-gradient);
            color: white;
            padding: 4rem 0 6rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
        }
        
        .hero-content {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .hero-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, #FFE082, #FFCC02);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .calculator-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            margin: -3rem auto 4rem auto;
            max-width: 600px;
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 10;
        }
        
        .calculator-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .input-group { margin-bottom: 1.5rem; }
        
        .input-label {
            display: block;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }
        
        .input-field {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 1.25rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .results-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            display: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .result-card {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .result-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        
        .result-label {
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .result-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .city-navigation {
            background: var(--bg-light);
            padding: 4rem 0;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            color: var(--text);
            margin-bottom: 1rem;
        }
        
        .section-subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .popular-cities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .city-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        
        .city-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            text-decoration: none;
        }
        
        .city-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .city-info {
            color: var(--text-light);
            margin-bottom: 1rem;
        }
        
        .city-times {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .time-info {
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: 8px;
        }
        
        .time-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }
        
        .time-value {
            font-weight: 700;
            color: var(--text);
        }
        
        .error-message {
            color: #EF4444;
            background: #FEF2F2;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--primary);
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .input-row { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr 1fr; }
            .city-times { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">üåÖ Sun Times Calculator</h1>
                <p class="hero-subtitle">
                    Get accurate sunrise and sunset times for any location worldwide. 
                    Perfect for photography, outdoor activities, and planning your day.
                </p>
            </div>
        </div>
    </section>

    <div class="container">
        <div class="calculator-card">
            <h2 class="calculator-title">Calculate Sun Times for Any Location</h2>
            
            <form id="sunCalculatorForm">
                <div class="input-group">
                    <label class="input-label" for="location">üè° Location</label>
                    <input type="text" id="location" class="input-field" 
                           placeholder="Enter city (e.g., Fort Atkinson, WI)">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label" for="date">üìÖ Date</label>
                        <input type="date" id="date" class="input-field">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="timezone">üåç Timezone</label>
                        <select id="timezone" class="input-field">
                            <option value="auto">Auto-detect</option>
                            <option value="America/New_York">Eastern Time</option>
                            <option value="America/Chicago">Central Time</option>
                            <option value="America/Denver">Mountain Time</option>
                            <option value="America/Los_Angeles">Pacific Time</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="calculate-btn">‚ú® Calculate Sun Times</button>
            </form>

            <div class="loading" id="loading">Calculating sun times...</div>
            <div class="error-message" id="errorMessage"></div>

            <div class="results-section" id="results">
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-icon">üåÖ</div>
                        <div class="result-label">Sunrise</div>
                        <div class="result-value" id="sunrise">--:--</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">üåá</div>
                        <div class="result-label">Sunset</div>
                        <div class="result-value" id="sunset">--:--</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">üìê</div>
                        <div class="result-label">Day Length</div>
                        <div class="result-value" id="dayLength">-- hrs</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">‚ú®</div>
                        <div class="result-label">Golden Hour</div>
                        <div class="result-value" id="goldenHour">--:--</div>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-icon">üåÑ</div>
                        <div class="result-label">Civil Dawn</div>
                        <div class="result-value" id="civilDawn">--:--</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">üåÜ</div>
                        <div class="result-label">Civil Dusk</div>
                        <div class="result-value" id="civilDusk">--:--</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">‚≠ê</div>
                        <div class="result-label">Nautical Dawn</div>
                        <div class="result-value" id="nauticalDawn">--:--</div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">üåå</div>
                        <div class="result-label">Nautical Dusk</div>
                        <div class="result-value" id="nauticalDusk">--:--</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="city-navigation">
        <div class="container">
            <h2 class="section-title">Popular Cities</h2>
            <p class="section-subtitle">
                Quick access to sun times for major cities with detailed photography tips.
            </p>
            
            <div class="popular-cities" id="popularCities">
                <!-- Cities populated by JavaScript -->
            </div>
        </div>
    </section>

    <script>
        document.getElementById('date').valueAsDate = new Date();
        
        const popularCities = [
            { name: 'New York', state: 'NY', url: '/locations/ny/new-york-ny.html', sunrise: '6:42 AM', sunset: '7:28 PM' },
            { name: 'Los Angeles', state: 'CA', url: '/locations/ca/los-angeles-ca.html', sunrise: '6:15 AM', sunset: '7:45 PM' },
            { name: 'Chicago', state: 'IL', url: '/locations/il/chicago-il.html', sunrise: '6:28 AM', sunset: '7:15 PM' }
        ];
        
        function populatePopularCities() {
            const container = document.getElementById('popularCities');
            container.innerHTML = popularCities.map(city => `
                <a href="${city.url}" class="city-card">
                    <div class="city-name">${city.name}, ${city.state}</div>
                    <div class="city-info">Detailed sun times and photography tips</div>
                    <div class="city-times">
                        <div class="time-info">
                            <div class="time-label">Sunrise</div>
                            <div class="time-value">${city.sunrise}</div>
                        </div>
                        <div class="time-info">
                            <div class="time-label">Sunset</div>
                            <div class="time-value">${city.sunset}</div>
                        </div>
                    </div>
                </a>
            `).join('');
        }
        
        // WORKING Sun Calculator - Uses basic astronomical formulas
        class SunCalculator {
            calculateSunTimes(lat, lng, date) {
                const rad = Math.PI / 180;
                const deg = 180 / Math.PI;
                
                // Julian day calculation
                const a = Math.floor((14 - (date.getMonth() + 1)) / 12);
                const y = date.getFullYear() - a;
                const m = (date.getMonth() + 1) + 12 * a - 3;
                const jd = date.getDate() + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
                
                // Days since J2000.0
                const n = jd - 2451545.0;
                
                // Mean solar longitude
                const L = (280.460 + 0.9856474 * n) % 360;
                
                // Mean anomaly of the sun
                const g = rad * ((357.528 + 0.9856003 * n) % 360);
                
                // Ecliptic longitude of sun
                const lambda = rad * (L + 1.915 * Math.sin(g) + 0.020 * Math.sin(2 * g));
                
                // Declination of sun
                const delta = Math.asin(Math.sin(rad * 23.439) * Math.sin(lambda));
                
                // Hour angle
                const latRad = lat * rad;
                const cosH = (Math.sin(rad * -0.833) - Math.sin(latRad) * Math.sin(delta)) / (Math.cos(latRad) * Math.cos(delta));
                
                // Check for polar day/night
                if (cosH > 1) return { sunrise: null, sunset: null }; // No sunrise
                if (cosH < -1) return { sunrise: null, sunset: null }; // No sunset
                
                const H = Math.acos(cosH) * deg;
                
                // Right ascension
                const alpha = Math.atan2(Math.cos(rad * 23.439) * Math.sin(lambda), Math.cos(lambda)) * deg;
                
                // Equation of time
                const EoT = 4 * (L - alpha);
                
                // Solar transit (solar noon)
                const transit = (720 - 4 * lng - EoT) / 1440;
                
                // Sunrise and sunset
                const sunrise_fraction = transit - H * 4 / 1440;
                const sunset_fraction = transit + H * 4 / 1440;
                
                // Convert fractions to actual times
                const sunrise = new Date(date);
                sunrise.setHours(0, 0, 0, 0);
                sunrise.setTime(sunrise.getTime() + sunrise_fraction * 24 * 60 * 60 * 1000);
                
                const sunset = new Date(date);
                sunset.setHours(0, 0, 0, 0);
                sunset.setTime(sunset.getTime() + sunset_fraction * 24 * 60 * 60 * 1000);
                
                // Civil twilight (sun 6¬∞ below horizon)
                const cosH_civil = (Math.sin(rad * -6) - Math.sin(latRad) * Math.sin(delta)) / (Math.cos(latRad) * Math.cos(delta));
                let civilDawn = sunrise;
                let civilDusk = sunset;
                
                if (cosH_civil >= -1 && cosH_civil <= 1) {
                    const H_civil = Math.acos(cosH_civil) * deg;
                    const civil_dawn_fraction = transit - H_civil * 4 / 1440;
                    const civil_dusk_fraction = transit + H_civil * 4 / 1440;
                    
                    civilDawn = new Date(date);
                    civilDawn.setHours(0, 0, 0, 0);
                    civilDawn.setTime(civilDawn.getTime() + civil_dawn_fraction * 24 * 60 * 60 * 1000);
                    
                    civilDusk = new Date(date);
                    civilDusk.setHours(0, 0, 0, 0);
                    civilDusk.setTime(civilDusk.getTime() + civil_dusk_fraction * 24 * 60 * 60 * 1000);
                }
                
                // Nautical twilight (approximate)
                const nauticalDawn = new Date(civilDawn.getTime() - 30 * 60 * 1000);
                const nauticalDusk = new Date(civilDusk.getTime() + 30 * 60 * 1000);
                
                return {
                    sunrise,
                    sunset,
                    civilDawn,
                    civilDusk,
                    nauticalDawn,
                    nauticalDusk
                };
            }
            
            formatTime(date, timezone = 'America/Chicago') {
                if (!date || isNaN(date.getTime())) return 'N/A';
                return date.toLocaleTimeString('en-US', {
                    timeZone: timezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
            }
            
            calculateDayLength(sunrise, sunset) {
                if (!sunrise || !sunset || isNaN(sunrise.getTime()) || isNaN(sunset.getTime())) return 'N/A';
                const diff = sunset.getTime() - sunrise.getTime();
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                return `${hours}h ${minutes}m`;
            }
        }
        
        // Location lookup
        async function geocodeLocation(location) {
            const lookup = {
                'fort atkinson': { lat: 42.9289, lng: -88.8370, timezone: 'America/Chicago' },
                'wisconsin': { lat: 44.5, lng: -89.5, timezone: 'America/Chicago' },
                'los angeles': { lat: 34.0522, lng: -118.2437, timezone: 'America/Los_Angeles' },
                'la': { lat: 34.0522, lng: -118.2437, timezone: 'America/Los_Angeles' },
                'new york': { lat: 40.7128, lng: -74.0060, timezone: 'America/New_York' },
                'nyc': { lat: 40.7128, lng: -74.0060, timezone: 'America/New_York' },
                'chicago': { lat: 41.8781, lng: -87.6298, timezone: 'America/Chicago' },
                'houston': { lat: 29.7604, lng: -95.3698, timezone: 'America/Chicago' },
                'phoenix': { lat: 33.4484, lng: -112.0740, timezone: 'America/Phoenix' },
                'philadelphia': { lat: 39.9526, lng: -75.1652, timezone: 'America/New_York' }
            };
            
            const key = location.toLowerCase().trim();
            
            // Check for exact matches first
            if (lookup[key]) return lookup[key];
            
            // Then check for partial matches
            for (const [city, coords] of Object.entries(lookup)) {
                if (key.includes(city)) return coords;
            }
            
            // Default to Fort Atkinson if nothing found
            return { lat: 42.9289, lng: -88.8370, timezone: 'America/Chicago' };
        }
        
        // Form handler
        document.getElementById('sunCalculatorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const location = document.getElementById('location').value;
            const date = new Date(document.getElementById('date').value);
            const loadingElement = document.getElementById('loading');
            const resultsElement = document.getElementById('results');
            const errorElement = document.getElementById('errorMessage');
            
            if (!location) {
                errorElement.textContent = 'Please enter a location';
                errorElement.style.display = 'block';
                return;
            }
            
            loadingElement.style.display = 'block';
            resultsElement.style.display = 'none';
            errorElement.style.display = 'none';
            
            try {
                const coords = await geocodeLocation(location);
                const calculator = new SunCalculator();
                const sunTimes = calculator.calculateSunTimes(coords.lat, coords.lng, date);
                
                if (!sunTimes.sunrise || !sunTimes.sunset) {
                    throw new Error('Unable to calculate for polar regions or invalid date');
                }
                
                // Update display with results
                document.getElementById('sunrise').textContent = calculator.formatTime(sunTimes.sunrise, coords.timezone);
                document.getElementById('sunset').textContent = calculator.formatTime(sunTimes.sunset, coords.timezone);
                document.getElementById('dayLength').textContent = calculator.calculateDayLength(sunTimes.sunrise, sunTimes.sunset);
                
                // Golden hour (1 hour before sunset)
                const goldenHour = new Date(sunTimes.sunset.getTime() - 60 * 60 * 1000);
                document.getElementById('goldenHour').textContent = calculator.formatTime(goldenHour, coords.timezone);
                
                // Twilight times
                document.getElementById('civilDawn').textContent = calculator.formatTime(sunTimes.civilDawn, coords.timezone);
                document.getElementById('civilDusk').textContent = calculator.formatTime(sunTimes.civilDusk, coords.timezone);
                document.getElementById('nauticalDawn').textContent = calculator.formatTime(sunTimes.nauticalDawn, coords.timezone);
                document.getElementById('nauticalDusk').textContent = calculator.formatTime(sunTimes.nauticalDusk, coords.timezone);
                
                loadingElement.style.display = 'none';
                resultsElement.style.display = 'block';
                
                // Analytics tracking
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'sun_calculation', { 'location': location });
                }
                
            } catch (error) {
                console.error('Calculator error:', error);
                loadingElement.style.display = 'none';
                errorElement.textContent = 'Unable to calculate sun times. Please try a different location.';
                errorElement.style.display = 'block';
            }
        });
        
        // Initialize
        populatePopularCities();
    </script>
</body>
</html>